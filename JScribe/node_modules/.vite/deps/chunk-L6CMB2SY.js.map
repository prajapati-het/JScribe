{
  "version": 3,
  "sources": ["../../@codemirror/legacy-modes/mode/tiki.js"],
  "sourcesContent": ["function inBlock(style, terminator, returnTokenizer) {\r\n  return function(stream, state) {\r\n    while (!stream.eol()) {\r\n      if (stream.match(terminator)) {\r\n        state.tokenize = inText;\r\n        break;\r\n      }\r\n      stream.next();\r\n    }\r\n\r\n    if (returnTokenizer) state.tokenize = returnTokenizer;\r\n\r\n    return style;\r\n  };\r\n}\r\n\r\nfunction inLine(style) {\r\n  return function(stream, state) {\r\n    while(!stream.eol()) {\r\n      stream.next();\r\n    }\r\n    state.tokenize = inText;\r\n    return style;\r\n  };\r\n}\r\n\r\nfunction inText(stream, state) {\r\n  function chain(parser) {\r\n    state.tokenize = parser;\r\n    return parser(stream, state);\r\n  }\r\n\r\n  var sol = stream.sol();\r\n  var ch = stream.next();\r\n\r\n  //non start of line\r\n  switch (ch) { //switch is generally much faster than if, so it is used here\r\n  case \"{\": //plugin\r\n    stream.eat(\"/\");\r\n    stream.eatSpace();\r\n    stream.eatWhile(/[^\\s\\u00a0=\\\"\\'\\/?(}]/);\r\n    state.tokenize = inPlugin;\r\n    return \"tag\";\r\n  case \"_\": //bold\r\n    if (stream.eat(\"_\"))\r\n      return chain(inBlock(\"strong\", \"__\", inText));\r\n    break;\r\n  case \"'\": //italics\r\n    if (stream.eat(\"'\"))\r\n      return chain(inBlock(\"em\", \"''\", inText));\r\n    break;\r\n  case \"(\":// Wiki Link\r\n    if (stream.eat(\"(\"))\r\n      return chain(inBlock(\"link\", \"))\", inText));\r\n    break;\r\n  case \"[\":// Weblink\r\n    return chain(inBlock(\"url\", \"]\", inText));\r\n    break;\r\n  case \"|\": //table\r\n    if (stream.eat(\"|\"))\r\n      return chain(inBlock(\"comment\", \"||\"));\r\n    break;\r\n  case \"-\":\r\n    if (stream.eat(\"=\")) {//titleBar\r\n      return chain(inBlock(\"header string\", \"=-\", inText));\r\n    } else if (stream.eat(\"-\")) {//deleted\r\n      return chain(inBlock(\"error tw-deleted\", \"--\", inText));\r\n    }\r\n    break;\r\n  case \"=\": //underline\r\n    if (stream.match(\"==\"))\r\n      return chain(inBlock(\"tw-underline\", \"===\", inText));\r\n    break;\r\n  case \":\":\r\n    if (stream.eat(\":\"))\r\n      return chain(inBlock(\"comment\", \"::\"));\r\n    break;\r\n  case \"^\": //box\r\n    return chain(inBlock(\"tw-box\", \"^\"));\r\n    break;\r\n  case \"~\": //np\r\n    if (stream.match(\"np~\"))\r\n      return chain(inBlock(\"meta\", \"~/np~\"));\r\n    break;\r\n  }\r\n\r\n  //start of line types\r\n  if (sol) {\r\n    switch (ch) {\r\n    case \"!\": //header at start of line\r\n      if (stream.match('!!!!!')) {\r\n        return chain(inLine(\"header string\"));\r\n      } else if (stream.match('!!!!')) {\r\n        return chain(inLine(\"header string\"));\r\n      } else if (stream.match('!!!')) {\r\n        return chain(inLine(\"header string\"));\r\n      } else if (stream.match('!!')) {\r\n        return chain(inLine(\"header string\"));\r\n      } else {\r\n        return chain(inLine(\"header string\"));\r\n      }\r\n      break;\r\n    case \"*\": //unordered list line item, or <li /> at start of line\r\n    case \"#\": //ordered list line item, or <li /> at start of line\r\n    case \"+\": //ordered list line item, or <li /> at start of line\r\n      return chain(inLine(\"tw-listitem bracket\"));\r\n      break;\r\n    }\r\n  }\r\n\r\n  //stream.eatWhile(/[&{]/); was eating up plugins, turned off to act less like html and more like tiki\r\n  return null;\r\n}\r\n\r\n// Return variables for tokenizers\r\nvar pluginName, type;\r\nfunction inPlugin(stream, state) {\r\n  var ch = stream.next();\r\n  var peek = stream.peek();\r\n\r\n  if (ch == \"}\") {\r\n    state.tokenize = inText;\r\n    //type = ch == \")\" ? \"endPlugin\" : \"selfclosePlugin\"; inPlugin\r\n    return \"tag\";\r\n  } else if (ch == \"(\" || ch == \")\") {\r\n    return \"bracket\";\r\n  } else if (ch == \"=\") {\r\n    type = \"equals\";\r\n\r\n    if (peek == \">\") {\r\n      stream.next();\r\n      peek = stream.peek();\r\n    }\r\n\r\n    //here we detect values directly after equal character with no quotes\r\n    if (!/[\\'\\\"]/.test(peek)) {\r\n      state.tokenize = inAttributeNoQuote();\r\n    }\r\n    //end detect values\r\n\r\n    return \"operator\";\r\n  } else if (/[\\'\\\"]/.test(ch)) {\r\n    state.tokenize = inAttribute(ch);\r\n    return state.tokenize(stream, state);\r\n  } else {\r\n    stream.eatWhile(/[^\\s\\u00a0=\\\"\\'\\/?]/);\r\n    return \"keyword\";\r\n  }\r\n}\r\n\r\nfunction inAttribute(quote) {\r\n  return function(stream, state) {\r\n    while (!stream.eol()) {\r\n      if (stream.next() == quote) {\r\n        state.tokenize = inPlugin;\r\n        break;\r\n      }\r\n    }\r\n    return \"string\";\r\n  };\r\n}\r\n\r\nfunction inAttributeNoQuote() {\r\n  return function(stream, state) {\r\n    while (!stream.eol()) {\r\n      var ch = stream.next();\r\n      var peek = stream.peek();\r\n      if (ch == \" \" || ch == \",\" || /[ )}]/.test(peek)) {\r\n        state.tokenize = inPlugin;\r\n        break;\r\n      }\r\n    }\r\n    return \"string\";\r\n  };\r\n}\r\n\r\nvar curState, setStyle;\r\nfunction pass() {\r\n  for (var i = arguments.length - 1; i >= 0; i--) curState.cc.push(arguments[i]);\r\n}\r\n\r\nfunction cont() {\r\n  pass.apply(null, arguments);\r\n  return true;\r\n}\r\n\r\nfunction pushContext(pluginName, startOfLine) {\r\n  var noIndent = curState.context && curState.context.noIndent;\r\n  curState.context = {\r\n    prev: curState.context,\r\n    pluginName: pluginName,\r\n    indent: curState.indented,\r\n    startOfLine: startOfLine,\r\n    noIndent: noIndent\r\n  };\r\n}\r\n\r\nfunction popContext() {\r\n  if (curState.context) curState.context = curState.context.prev;\r\n}\r\n\r\nfunction element(type) {\r\n  if (type == \"openPlugin\") {curState.pluginName = pluginName; return cont(attributes, endplugin(curState.startOfLine));}\r\n  else if (type == \"closePlugin\") {\r\n    var err = false;\r\n    if (curState.context) {\r\n      err = curState.context.pluginName != pluginName;\r\n      popContext();\r\n    } else {\r\n      err = true;\r\n    }\r\n    if (err) setStyle = \"error\";\r\n    return cont(endcloseplugin(err));\r\n  }\r\n  else if (type == \"string\") {\r\n    if (!curState.context || curState.context.name != \"!cdata\") pushContext(\"!cdata\");\r\n    if (curState.tokenize == inText) popContext();\r\n    return cont();\r\n  }\r\n  else return cont();\r\n}\r\n\r\nfunction endplugin(startOfLine) {\r\n  return function(type) {\r\n    if (\r\n      type == \"selfclosePlugin\" ||\r\n        type == \"endPlugin\"\r\n    )\r\n      return cont();\r\n    if (type == \"endPlugin\") {pushContext(curState.pluginName, startOfLine); return cont();}\r\n    return cont();\r\n  };\r\n}\r\n\r\nfunction endcloseplugin(err) {\r\n  return function(type) {\r\n    if (err) setStyle = \"error\";\r\n    if (type == \"endPlugin\") return cont();\r\n    return pass();\r\n  };\r\n}\r\n\r\nfunction attributes(type) {\r\n  if (type == \"keyword\") {setStyle = \"attribute\"; return cont(attributes);}\r\n  if (type == \"equals\") return cont(attvalue, attributes);\r\n  return pass();\r\n}\r\nfunction attvalue(type) {\r\n  if (type == \"keyword\") {setStyle = \"string\"; return cont();}\r\n  if (type == \"string\") return cont(attvaluemaybe);\r\n  return pass();\r\n}\r\nfunction attvaluemaybe(type) {\r\n  if (type == \"string\") return cont(attvaluemaybe);\r\n  else return pass();\r\n}\r\nexport const tiki = {\r\n  name: \"tiki\",\r\n  startState: function() {\r\n    return {tokenize: inText, cc: [], indented: 0, startOfLine: true, pluginName: null, context: null};\r\n  },\r\n  token: function(stream, state) {\r\n    if (stream.sol()) {\r\n      state.startOfLine = true;\r\n      state.indented = stream.indentation();\r\n    }\r\n    if (stream.eatSpace()) return null;\r\n\r\n    setStyle = type = pluginName = null;\r\n    var style = state.tokenize(stream, state);\r\n    if ((style || type) && style != \"comment\") {\r\n      curState = state;\r\n      while (true) {\r\n        var comb = state.cc.pop() || element;\r\n        if (comb(type || style)) break;\r\n      }\r\n    }\r\n    state.startOfLine = false;\r\n    return setStyle || style;\r\n  },\r\n  indent: function(state, textAfter, cx) {\r\n    var context = state.context;\r\n    if (context && context.noIndent) return 0;\r\n    if (context && /^{\\//.test(textAfter))\r\n      context = context.prev;\r\n    while (context && !context.startOfLine)\r\n      context = context.prev;\r\n    if (context) return context.indent + cx.unit;\r\n    else return 0;\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": ["pluginName", "type"]
}
